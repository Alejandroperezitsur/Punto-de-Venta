import{c as d,r as s,e as i,d as e,B as u,h as z,C as l,I as h,W as j,f as c,H as T}from"./index-B1nNtzDp.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],V=d("circle-alert",I);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],H=d("circle-arrow-down",$);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],P=d("circle-arrow-up",B);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M10 12h.01",key:"1kxr2c"}],["path",{d:"M18 20V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14",key:"36qu9e"}],["path",{d:"M2 20h20",key:"owomy5"}]],q=d("door-closed",F);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M11 20H2",key:"nlcfvz"}],["path",{d:"M11 4.562v16.157a1 1 0 0 0 1.242.97L19 20V5.562a2 2 0 0 0-1.515-1.94l-4-1A2 2 0 0 0 11 4.561z",key:"au4z13"}],["path",{d:"M11 4H8a2 2 0 0 0-2 2v14",key:"74r1mk"}],["path",{d:"M14 12h.01",key:"1jfl7z"}],["path",{d:"M22 20h-3",key:"vhrsz"}]],W=d("door-open",J),G=()=>{const[o,f]=s.useState(null),[m,g]=s.useState([]),[E,y]=s.useState(!0),[v,N]=s.useState(""),[b,w]=s.useState(""),[k,C]=s.useState(""),[p,_]=s.useState("deposit"),[x,r]=s.useState(!1),n=s.useCallback(async()=>{y(!0);try{const{session:t}=await i("/cash/status");if(f(t||null),t){const a=await i("/cash/movements");g(a)}else g([])}catch(t){console.error(t),f(null)}finally{y(!1)}},[]);s.useEffect(()=>{n()},[n]);const R=async()=>{r(!0);try{await i("/cash/open",{method:"POST",body:JSON.stringify({opening_balance:parseFloat(v)||0})}),N(""),await n(),window.dispatchEvent(new CustomEvent("cash-status",{detail:{open:!0}}))}catch(t){alert("Error al abrir caja: "+t.message)}finally{r(!1)}},L=async()=>{if(window.confirm("¿Cerrar la caja actual?")){r(!0);try{await i("/cash/close",{method:"POST"}),await n(),window.dispatchEvent(new CustomEvent("cash-status",{detail:{open:!1}}))}catch(t){alert("Error al cerrar caja: "+t.message)}finally{r(!1)}}},D=async()=>{const t=parseFloat(b);if(!t||t<=0)return alert("Ingrese un monto válido");r(!0);try{await i(p==="deposit"?"/cash/deposit":"/cash/withdraw",{method:"POST",body:JSON.stringify({amount:t,reference:k||(p==="deposit"?"Depósito":"Retiro")})}),w(""),C(""),await n()}catch(a){alert("Error: "+a.message)}finally{r(!1)}},S=m.filter(t=>t.type==="sale").reduce((t,a)=>t+(a.amount||0),0),M=m.filter(t=>t.type==="deposit").reduce((t,a)=>t+(a.amount||0),0),A=m.filter(t=>t.type==="withdraw").reduce((t,a)=>t+Math.abs(a.amount||0),0),O=o?(o.opening_balance||0)+S+M-A:0;return e.createElement("div",{className:"space-y-6 max-w-4xl mx-auto"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("h1",{className:"text-2xl font-bold"},"Control de Caja"),e.createElement(u,{variant:"ghost",onClick:n,isLoading:E},e.createElement(z,{className:"h-4 w-4 mr-2"})," Actualizar")),E?e.createElement(l,{className:"p-12 text-center text-[hsl(var(--muted-foreground))]"},"Cargando estado de caja..."):o?e.createElement("div",{className:"space-y-6 animate-fade-in"},e.createElement(l,{className:"p-6 border-l-4 border-l-green-500 bg-gradient-to-r from-green-50/50 to-transparent dark:from-green-900/10"},e.createElement("div",{className:"flex items-center justify-between flex-wrap gap-4"},e.createElement("div",{className:"flex items-center gap-4"},e.createElement("div",{className:"p-3 bg-green-100 text-green-600 rounded-full"},e.createElement(j,{className:"h-6 w-6"})),e.createElement("div",null,e.createElement("h3",{className:"font-bold text-lg text-green-700 dark:text-green-400"},"Caja Abierta"),e.createElement("p",{className:"text-sm text-[hsl(var(--muted-foreground))]"},"Abierta: ",new Date(o.opened_at).toLocaleString()," • Inicial: ",c(o.opening_balance)))),e.createElement(u,{variant:"outline",onClick:L,isLoading:x,className:"border-red-200 text-red-600 hover:bg-red-50"},e.createElement(q,{className:"h-4 w-4 mr-2"})," Cerrar Caja"))),e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4"},e.createElement(l,{className:"p-4 text-center"},e.createElement("p",{className:"text-xs text-[hsl(var(--muted-foreground))] uppercase font-semibold"},"Ventas (Efectivo)"),e.createElement("p",{className:"text-xl font-bold text-green-600"},c(S))),e.createElement(l,{className:"p-4 text-center"},e.createElement("p",{className:"text-xs text-[hsl(var(--muted-foreground))] uppercase font-semibold"},"Depósitos"),e.createElement("p",{className:"text-xl font-bold text-blue-600"},c(M))),e.createElement(l,{className:"p-4 text-center"},e.createElement("p",{className:"text-xs text-[hsl(var(--muted-foreground))] uppercase font-semibold"},"Retiros"),e.createElement("p",{className:"text-xl font-bold text-red-500"},c(A))),e.createElement(l,{className:"p-4 text-center border-2 border-[hsl(var(--primary))]"},e.createElement("p",{className:"text-xs text-[hsl(var(--muted-foreground))] uppercase font-semibold"},"Saldo Estimado"),e.createElement("p",{className:"text-xl font-black text-[hsl(var(--primary))]"},c(O)))),e.createElement(l,{className:"p-6"},e.createElement("h4",{className:"font-semibold mb-4"},"Registrar Movimiento"),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end"},e.createElement("div",null,e.createElement("label",{className:"text-xs font-medium mb-1 block"},"Tipo"),e.createElement("select",{className:"flex h-10 w-full rounded-md border border-[hsl(var(--border))] bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[hsl(var(--primary))]",value:p,onChange:t=>_(t.target.value)},e.createElement("option",{value:"deposit"},"Depósito"),e.createElement("option",{value:"withdraw"},"Retiro"))),e.createElement("div",null,e.createElement("label",{className:"text-xs font-medium mb-1 block"},"Monto"),e.createElement(h,{type:"number",placeholder:"0.00",value:b,onChange:t=>w(t.target.value)})),e.createElement("div",null,e.createElement("label",{className:"text-xs font-medium mb-1 block"},"Referencia (Opcional)"),e.createElement(h,{placeholder:"Ej: Pago proveedor",value:k,onChange:t=>C(t.target.value)})),e.createElement(u,{onClick:D,isLoading:x},p==="deposit"?e.createElement(H,{className:"h-4 w-4 mr-2"}):e.createElement(P,{className:"h-4 w-4 mr-2"}),"Registrar"))),e.createElement(l,{className:"p-6"},e.createElement("div",{className:"flex items-center gap-2 mb-4"},e.createElement(T,{className:"h-5 w-5 text-[hsl(var(--muted-foreground))]"}),e.createElement("h4",{className:"font-semibold"},"Movimientos de esta Sesión")),m.length===0?e.createElement("p",{className:"text-center text-[hsl(var(--muted-foreground))] py-8"},"Sin movimientos registrados."):e.createElement("div",{className:"overflow-x-auto"},e.createElement("table",{className:"w-full text-sm"},e.createElement("thead",{className:"bg-[hsl(var(--muted))] text-[hsl(var(--muted-foreground))]"},e.createElement("tr",null,e.createElement("th",{className:"text-left px-4 py-2 font-medium"},"Tipo"),e.createElement("th",{className:"text-left px-4 py-2 font-medium"},"Referencia"),e.createElement("th",{className:"text-right px-4 py-2 font-medium"},"Monto"),e.createElement("th",{className:"text-left px-4 py-2 font-medium"},"Fecha"))),e.createElement("tbody",{className:"divide-y divide-[hsl(var(--border))]"},m.map(t=>e.createElement("tr",{key:t.id,className:"hover:bg-[hsl(var(--muted))/0.5]"},e.createElement("td",{className:"px-4 py-3"},e.createElement("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold ${t.type==="sale"?"bg-green-100 text-green-700":t.type==="deposit"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"}`},t.type==="sale"?"Venta":t.type==="deposit"?"Depósito":"Retiro")),e.createElement("td",{className:"px-4 py-3 text-[hsl(var(--muted-foreground))]"},t.reference||"-"),e.createElement("td",{className:`px-4 py-3 text-right font-semibold ${t.amount>=0?"text-green-600":"text-red-500"}`},t.amount>=0?"+":"",c(t.amount)),e.createElement("td",{className:"px-4 py-3 text-[hsl(var(--muted-foreground))] font-mono text-xs"},new Date(t.created_at).toLocaleString())))))))):e.createElement(l,{className:"p-8 space-y-6 border-l-4 border-l-amber-500 animate-fade-in"},e.createElement("div",{className:"flex items-center gap-4 text-amber-600"},e.createElement(V,{className:"h-8 w-8"}),e.createElement("div",null,e.createElement("h3",{className:"font-bold text-lg"},"Caja Cerrada"),e.createElement("p",{className:"text-sm text-[hsl(var(--muted-foreground))]"},"No hay sesión de caja activa. Abre una para comenzar."))),e.createElement("div",{className:"flex items-end gap-4"},e.createElement("div",{className:"flex-1"},e.createElement("label",{className:"text-xs font-medium mb-1 block"},"Saldo Inicial"),e.createElement(h,{type:"number",placeholder:"0.00",value:v,onChange:t=>N(t.target.value),icon:j})),e.createElement(u,{onClick:R,isLoading:x,className:"h-10"},e.createElement(W,{className:"h-4 w-4 mr-2"})," Abrir Caja"))))};export{G as default};
