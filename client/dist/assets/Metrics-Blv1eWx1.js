import{r as d,R as e,B as f,S as b,b as N}from"./index-DbtmaT95.js";function k(i){const h=String(i||"").split(`
`),r={sum:{},count:{}},p={};for(const t of h){const n=t.match(/^pos_http_request_duration_seconds_sum\{([^}]*)\}\s+(\d+(?:\.\d+)?)/),s=t.match(/^pos_http_request_duration_seconds_count\{([^}]*)\}\s+(\d+)/);if(n){const l=Object.fromEntries(n[1].split(",").map(c=>c.split("=")).map(([c,a])=>[c,String(a||"").replace(/^"|"$/g,"")])),m=`${l.method}:${l.route}:${l.status}`;r.sum[m]=parseFloat(n[2])}if(s){const l=Object.fromEntries(s[1].split(",").map(c=>c.split("=")).map(([c,a])=>[c,String(a||"").replace(/^"|"$/g,"")])),m=`${l.method}:${l.route}:${l.status}`;r.count[m]=parseFloat(s[2]),(parseInt(l.status,10)||0)>=500&&(p[l.route]=(p[l.route]||0)+parseFloat(s[2]))}}const o={};for(const t of Object.keys(r.count)){const[n,s,l]=t.split(":"),m=r.sum[t]||0,c=r.count[t]||0,a=c>0?m/c:0,u=o[s]||{route:s,samples:[],avg:0};u.samples.push({method:n,status:l,avg:a}),o[s]=u}for(const t of Object.values(o))t.avg=t.samples.reduce((n,s)=>n+s.avg,0)/(t.samples.length||1);return{list:Object.values(o).sort((t,n)=>n.avg-t.avg),errCount:p}}function S({points:i}){i.map((n,s)=>s);const o=i.map(n=>n.y),E=Math.max(0,...o),t=i.map((n,s)=>{const l=20+s/Math.max(1,i.length-1)*560,m=180-(E>0?n.y/E*(200-20*2):0);return`${s===0?"M":"L"}${l},${m}`}).join(" ");return e.createElement("svg",{width:600,height:200,style:{background:"var(--bg2)",borderRadius:6}},e.createElement("path",{d:t,stroke:"var(--primary)",fill:"none",strokeWidth:"2"}))}function _(){const[i,h]=d.useState(""),[r,p]=d.useState([]),[o,E]=d.useState({}),[t,n]=d.useState([]),[s,l]=d.useState(!1),m=async()=>{l(!0);try{const a=await N();h(a);const u=k(a);p(u.list),E(u.errCount);const y=u.list.length?u.list.reduce((g,v)=>g+v.avg,0)/u.list.length:0;n(g=>[...g.slice(-49),{x:Date.now(),y}])}catch{}finally{l(!1)}};d.useEffect(()=>{m()},[]);const c=d.useMemo(()=>r.slice(0,10),[r]);return e.createElement("div",{className:"container"},e.createElement(f,{items:["Admin","Métricas"]}),e.createElement("h2",null,"Métricas"),e.createElement("div",{className:"row",style:{justifyContent:"flex-end"}},e.createElement("button",{className:"btn",onClick:m},"Refrescar métricas")),e.createElement("div",{className:"grid-3",style:{gap:12,marginTop:8}},e.createElement("div",{className:"card"},e.createElement("h4",null,"Latencia promedio"),e.createElement("div",{className:"muted"},r.length?(r.reduce((a,u)=>a+u.avg,0)/r.length).toFixed(3):"0.000"," s")),e.createElement("div",{className:"card"},e.createElement("h4",null,"Rutas con error"),e.createElement("div",{className:"muted"},Object.keys(o).length)),e.createElement("div",{className:"card"},e.createElement("h4",null,"Muestras"),e.createElement("div",{className:"muted"},t.length))),e.createElement("div",{className:"card",style:{marginTop:12}},e.createElement("h3",null,"Latencia (línea)"),s&&t.length===0?e.createElement(b,{lines:4}):e.createElement(S,{points:t})),e.createElement("div",{className:"card",style:{marginTop:12}},e.createElement("h3",null,"Top rutas lentas"),e.createElement("table",{className:"table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Ruta"),e.createElement("th",null,"Promedio (s)"))),e.createElement("tbody",null,c.map(a=>e.createElement("tr",{key:a.route},e.createElement("td",null,a.route),e.createElement("td",{className:"right"},a.avg.toFixed(3))))))),e.createElement("div",{className:"card",style:{marginTop:12}},e.createElement("h3",null,"Errores por ruta"),e.createElement("table",{className:"table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Ruta"),e.createElement("th",null,"Errores"))),e.createElement("tbody",null,Object.keys(o).map(a=>e.createElement("tr",{key:a},e.createElement("td",null,a),e.createElement("td",{className:"right"},o[a])))))))}export{_ as default};
